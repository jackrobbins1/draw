var draw=function(){var e=document.querySelector("main").offsetWidth,t=document.querySelector("main").offsetHeight,n=document.createElement("canvas"),i=n.getContext("2d"),r=n.getBoundingClientRect(),o=0,l=0,s=0,a=0,d=0,c=0,u=0,h=0,f="",g=!1,y="",m="",w=[],k=0,S=[];return{randColor:function(){return"#"+Math.floor(16777215*Math.random()).toString(16)},setStrokeColor:function(e){y=e},setFillColor:function(e){m=e},getStrokeColor:function(){return 6<y.length?y:this.randColor()},getFillColor:function(){return 6<m.length?m:this.randColor()},setPoint:function(){w[k]=[],w[k].x=o,w[k].y=l,2<w.length?(this.draw(),k=0,w=[]):k++},setXY:function(e){u=o,h=l,o=e.clientX-r.left-n.offsetLeft,l=e.clientY-r.top-n.offsetTop},writeXY:function(){document.getElementById("trackX").innerHTML="X: "+o,document.getElementById("trackY").innerHTML="Y: "+l},setIsDrawing:function(e){g=e},getIsDrawing:function(){return g},setShape:function(e){f=e},setStart:function(){s=o,a=l},setEnd:function(){d=o,c=l},getCanvas:function(){return n},getShape:function(){return f},draw:function(){i.restore(),"rectangle"===f?this.drawRect():"line"===f?this.drawLine():"circle"===f?this.drawCircle():"path"===f?this.drawPath():"triangle"===f?this.drawTriangle():"3-point"===f?this.draw3Point():alert("Please choose a shape"),i.save()},drawLine:function(){i.strokeStyle=this.getStrokeColor(),i.beginPath(),i.moveTo(s,a),i.lineTo(d,c),i.stroke(),S.push({shape:"line",cords:{x1:s,y1:a,x2:d,y2:c},styles:{stroke:i.strokeStyle}})},drawRect:function(){i.fillStyle=this.getFillColor(),i.strokeStyle=this.getStrokeColor(),i.fillRect(s,a,d-s,c-a),i.strokeRect(s,a,d-s,c-a),S.push({shape:"rectangle",cords:{x1:s,y1:a,x2:d,y2:c},styles:{stroke:i.strokeStyle,fill:i.fillStyle}})},drawCircle:function(){i.fillStyle=this.getFillColor(),i.strokeStyle=this.getStrokeColor(),i.beginPath();var e=s-d,t=a-c;radius=Math.sqrt(e*e+t*t),i.arc(s,a,radius,0,2*Math.PI),i.stroke(),i.fill(),S.push({shape:"circle",cords:{x1:s,y1:a,x2:d,y2:c,r:radius},styles:{stroke:i.strokeStyle,fill:i.fillStyle}})},drawPath:function(){i.strokeStyle=this.getStrokeColor(),i.beginPath(),i.moveTo(u,h),i.lineTo(o,l),i.stroke(),S.push({shape:"path",cords:{lx:u,ly:h,x:o,y:l},styles:{stroke:i.strokeStyle}})},drawTriangle:function(){var e=s-d,t=a-c,n=Math.sqrt(e*e+t*t),r=s+n,o=a+n;d<s&&(r=s-n),c<a&&(o=a-n),i.fillStyle=this.getFillColor(),i.strokeStyle=this.getStrokeColor(),i.beginPath(),i.moveTo(s,a),i.lineTo(r,o),i.lineTo(d,c),i.lineTo(s,a),i.stroke(),i.fill(),S.push({shape:"triangle",cords:{x1:s,y1:a,x2:d,y2:c},styles:{stroke:i.strokeStyle,fill:i.fillStyle}})},draw3Point:function(){i.fillStyle=this.getFillColor(),i.strokeStyle=this.getStrokeColor(),i.beginPath(),i.moveTo(w[0].x,w[0].y),i.lineTo(w[1].x,w[1].y),i.lineTo(w[2].x,w[2].y),i.lineTo(w[0].x,w[0].y),i.stroke(),i.fill(),S.push({shape:"3-point",cords:{points:w},styles:{stroke:i.strokeStyle,fill:i.fillStyle}})},clear:function(){i.clearRect(0,0,t,e)},redraw:function(){for(item in S){switch(S[item].shape){case"path":f=S[item].shape,u=S[item].cords.lx,h=S[item].cords.ly,o=S[item].cords.x,l=S[item].cords.y,i.strokeStyle=S[item].styles.stroke;break;case"circle":case"line":case"rectangle":case"triangle":f=S[item].shape,s=S[item].cords.x1,a=S[item].cords.y1,d=S[item].cords.x2,c=S[item].cords.y2,i.strokeStyle=S[item].styles.stroke,i.fillStyle=S[item].styles.fill;break;case"3-point":f=S[item].shape,w=S[item].cords.points,i.strokeStyle=S[item].styles.stroke,i.fillStyle=S[item].styles.fill}this.draw()}},init:function(){n.width=e,n.height=t,document.querySelector("main").appendChild(n)}}}();draw.init(),draw.getCanvas().addEventListener("mousemove",function(e){draw.setXY(e),draw.writeXY(),"path"===draw.getShape()&&!0===draw.getIsDrawing()&&draw.draw()}),draw.getCanvas().addEventListener("mousedown",function(){"3-point"!==draw.getShape()&&(draw.setStart(),draw.setIsDrawing(!0))}),draw.getCanvas().addEventListener("mouseup",function(){"3-point"!==draw.getShape()&&(draw.setEnd(),draw.draw(),draw.setIsDrawing(!1))}),draw.getCanvas().addEventListener("mouseup",function(){"3-point"===draw.getShape()&&draw.setPoint()}),document.getElementById("btnRect").addEventListener("click",function(){draw.setShape("rectangle")}),document.getElementById("btnLine").addEventListener("click",function(){draw.setShape("line")}),document.getElementById("btnCircle").addEventListener("click",function(){draw.setShape("circle")}),document.getElementById("btnPath").addEventListener("click",function(){draw.setShape("path")}),document.getElementById("btnTriangle").addEventListener("click",function(){draw.setShape("triangle")}),document.getElementById("btn3Point").addEventListener("click",function(){draw.setShape("3-point")}),document.getElementById("strokeColor").addEventListener("change",function(){draw.setStrokeColor(document.getElementById("strokeColor").value)}),document.getElementById("randStrokeColor").addEventListener("change",function(){draw.setStrokeColor("")}),document.getElementById("fillColor").addEventListener("change",function(){draw.setFillColor(document.getElementById("fillColor").value)}),document.getElementById("randFillColor").addEventListener("change",function(){draw.setFillColor("")}),document.getElementById("btnClear").addEventListener("click",function(){draw.clear()}),document.getElementById("btnRedraw").addEventListener("click",function(){draw.redraw()});